消息队列

#### 概念

+ 传输数据的先进先出队列
+ 生产者将数据放到消息队列里
+ 消费中从消息队列中取出数据
+ 数据不能实时送达

#### 优点

##### 异步

+ 一个流程中有很多个步骤，导致处理起来很慢

  ![image-20201202111417062](https://gitee.com/ly10208/images/raw/master/img/20201202111417.png)

+ 可以让该流程只做主要的任务，其他的任务异步处理

  ![image-20201202111611894](https://gitee.com/ly10208/images/raw/master/img/20201202111612.png)

##### 解耦

+ 上述异步处理当然也可以通过线程去做，但是会导致系统间的耦合性太强，而且出错也不好处理

+ 引入消息队列后，只需要处理自己的流程，并将自己的消息发送出去，其他系统需要接入，直接订阅消息

  ![image-20201202112247747](https://gitee.com/ly10208/images/raw/master/img/20201202112247.png)

##### 削峰限流

+ 当某一个时刻请求过大时，可能会使得服务器宕机
+ 可以将请求都放入消息队列中，让服务器慢慢处理

#### 缺点

##### 系统复杂性

+ 增加一个中间件，需要去维护，而且还需要处理重复消费、消息丢失、顺序消费等问题

##### 数据一致性

+ 各模块解耦合之后，每个模块只负责自己的工作可能会导致数据不一致
+ 可以使用分布式事务

##### 可用性

+ 中间件可能会挂掉

#### 生产者丢失

+ 生产者发送消息失败没有重试、或者发送成功MQ网络闪断没有收到

